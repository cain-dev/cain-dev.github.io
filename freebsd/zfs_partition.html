<!DOCTYPE html>
<html lang="pt-BR" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta name="keywords" content="formata√ß√£o, windows, linux, freebsd, bios, uefi, instala√ß√£o, balena, etcher, ventoy, os">
    <meta name="author" content="Cain">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instala√ß√£o manual com ZFS</title>
    <!--Social Media Open Graph-->
    <meta property="og:title" content="Instala√ß√£o manual do FreeBSD com ZFS"/>
    <meta property="og:url" content="https://cain-dev.github.io/"/>
    <meta property="og:type" content="article"/>
    <meta property="og:description" content="Aprenda a instalar FreeBSD com ZFS manualmente, muito √∫til para instalar em parti√ß√µes."/>
    <meta property="og:image" content="https://raw.githubusercontent.com/cain-dev/default/main/assets/images/ogimage.jpg"/>
    <!--/Social Media Open Graph-->
    <!--Links-->
    <link rel="shortcut icon" href="https://www.freebsd.org/favicon.ico">
    <link rel="stylesheet" type="text/css"href="../os_style.css">   
    <!--/Links-->
</head>
<body>
    <header id="main-header">
        <ul>
            <li><a href="../index.html">Home</a></li>
            <li><p>@cain-dev</p></li>
            <li><a href="../extra/contact.html">Contato</a></li>
        </ul>
    </header>
	<main id="main-area">
        <h2>Criando a parti√ß√£o no gdisk</h2>
        <p>O procedimento de cria√ß√£o de parti√ß√£o √© o mesmo que voc√™ j√° est√° acostumado, para criar a nova parti√ß√£o que ser√° usada como volume ZFS utilize o comando:</p>
        <code>n</code>
        <p>O sistema ir√° exibir a seguinte linha para que voc√™ escolha o n√∫mero da parti√ß√£o:</p>
        <code>partition number: default</code>
        <p>Apenas tecle <mark>Enter</mark>.</p>
        <p>Logo em seguida o sistema ir√° exibir a seguinte linha para que voc√™ escolha o ponto de in√≠cio da parti√ß√£o:</p>
        <code>first sector: default</code>
        <p>Apenas tecle <mark>Enter</mark>.</p>
        <p>Logo em seguida o sistema ir√° exibir a linha abaixo para que voc√™ escolha o ponto de t√©rmino da parti√ß√£o e delimite o seu tamanho, voc√™ pode apenas teclar <em>Enter</em> para ocupar todo o resto do armazenamento ou pode delimitar o seu tamanho como no exemplo abaixo:</p>
        <code>last sector: +<mark>200G</mark></code>
        <p>Logo em seguida o sistema ir√° exibir a linha abaixo para que voc√™ escolha o tipo da parti√ß√£o, para uma raiz de sistema de arquivo ZFS devemos utilizar o c√≥digo <mark>bf00</mark> (<em>Solaris root</em>) e teclar <mark>Enter</mark> de maneira que o di√°logo no terminal fique da seguinte forma:</p>
        <code>Hex code or GUID (L to show codes, Enter = 8300): bf00</code>
        <p>Com isso temos uma nova parti√ß√£o que ocupa 200G do disco e do tipo Solaris root.</p>
        <h4>Gravar as altera√ß√µes</h4>
        <p>Para gravar as altera√ß√µes da tabela de parti√ß√£o e sair do programa utilize o comando abaixo:</p>
        <code>w</code>
        <h2>Criando a pool</h2>
        <p>Antes mais nada √© necess√°rio encontrar a parti√ß√£o que voc√™ preparou previamente, para isso utilize o comando:</p>
        <code>gpart show</code>
        <p>Agora monte <em>tmpfs</em> em <em>/mnt</em>:</p>
        <code>mount -t tmpfs tmpfs /mnt</code>
        <p>Por fim crie a pool na parti√ß√£o desejada:</p>
        <code> zpool create -o altroot=/mnt zroot <mark>storageAP3</mark></code>
        <h2>Crie a hierarquia de sistema de arquivos no ZFS</h2>
        <p>Caso voc√™ queira habilitar compress√£o do tipo <em>lz4</em> por padr√£o na pool (altamente recomendado) voc√™ pode utilizar o comando abaixo:</p>
        <code>zfs set compress=on zroot</code>
        <p>Crie uma hierarquia de ambiente de inicializa√ß√£o:</p>
        <code> zfs create -o mountpoint=none zroot/ROOT<br>zfs create -o mountpoint=none zroot/ROOT/default<br>mount -t zfs zroot/ROOT/default /mnt</code>
        <p>Crie o resto da hierarquia de arquivos:</p>
        <code>zfs create -o mountpoint=/tmp -o exec=on -o setuid=off zroot/tmp<br>zfs create -o canmount=off -o mountpoint=/usr zroot/usr<br>zfs create zroot/usr/home<br>zfs create -o exec=off -o setuid=off zroot/usr/src<br>zfs create zroot/usr/obj<br>zfs create -o mountpoint=/usr/ports -o setuid=off zroot/usr/ports<br>zfs create -o exec=off -o setuid=off zroot/usr/ports/distfiles<br>zfs create -o exec=off -o setuid=off zroot/usr/ports/packages<br>zfs create -o canmount=off -o mountpoint=/var zroot/var<br>zfs create -o exec=off -o setuid=off zroot/var/audit<br>zfs create -o exec=off -o setuid=off zroot/var/crash<br>zfs create -o exec=off -o setuid=off zroot/var/log<br>zfs create -o atime=on -o exec=off -o setuid=off zroot/var/mail<br>zfs create -o exec=on -o setuid=off zroot/var/tmp</code>
        <p>Sete os devidos links e permiss√µes:</p>
        <code>ln -s /usr/home /mnt/home<br>chmod 1777 /mnt/var/tmp<br>chmod 1777 /mnt/tmp</code>
        <h2>Configure o ambiente de inicializa√ß√£o</h2>
        <code>zpool set bootfs=zroot/ROOT/default zroot</code>
        <h2>Finalize a instala√ß√£o</h2>
        <p>Saia do modo shell de particionamento para que o bsdinstall continue a instala√ß√£o:</p>
        <code>exit</code>
        <p>Na etapa de p√≥s-instala√ß√£o, quando perguntado se voc√™ gostaria de entrar no sistema instalado, escolha sim e execute os dois comandos a seguir:</p>
        <code>sysrc zfs_enable="YES"<br>echo 'zfs_load="YES"' >> /boot/loader.conf</code>
        <p>Se voc√™ est√° lendo isso as chances s√£o de que voc√™ j√° tem uma parti√ß√£o do tipo <em>ESP</em> pronta ou pelo menos sabe como faz√™-la, ent√£o agora precisamos copiar o arquivo de loader do FreeBSD para a parti√ß√£o <em>ESP</em>. Vamos come√ßar montando a parti√ß√£o <em>ESP</em> com o comando:</p>
        <code>mount -t msdosfs /dev/<mark>storageAP1</mark> /mnt</code>
        <p>Crie a pasta do loader do FreeBSD:</p>
        <code>mkdir /mnt/EFI/FreeBSD</code>
        <p>Copie o loader para a pasta do FreeBSD:</p>
        <code>cp /boot/loader.efi /mnt/EFI/FreeBSD/loader.efi</code>
        <p>Por fim basta desmontar a parti√ß√£o:</p>
        <code>umount /mnt</code>
    </main>
    <footer id="main-footer">
        <p>Est√° p√°gina ainda est√° em constru√ß√£o üöß</p>
        <a class="footerlink" href="#main-header">‚Üë Retornar ao topo ‚Üë</a>
    </footer>
</body>
</html>
