<!DOCTYPE html>
<html lang="pt-BR" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta name="keywords" content="formata√ß√£o, windows, linux, freebsd, bios, uefi, instala√ß√£o, balena, etcher, ventoy, os">
    <meta name="author" content="Cain">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hackintosh</title>
    <!--Social Media Open Graph-->
    <meta property="og:title" content="Instala√ß√£o de Sistemas Operacionais - Hackintosh"/>
    <meta property="og:url" content="https://cain-dev.github.io/default/"/>
    <meta property="og:type" content="article"/>
    <meta property="og:description" content="Aprenda a instalar o MacOS em sua m√°quina atrav√©s do Proxmox"/>
    <meta property="og:image" content="https://raw.githubusercontent.com/cain-dev/default/main/assets/images/ogimage.jpg"/>
    <!--/Social Media Open Graph-->
    <!--Links-->
    <link rel="shortcut icon" href="../assets/images/cainlogo.ico">
    <link rel="stylesheet" type="text/css"href="../os_style.css">   
    <!--/Links-->
</head>
<body>
    <header id="main-header">
        <ul>
            <li><a href="../index.html">Home</a></li>
            <li><p>@cain-dev</p></li>
            <li><a href="../extra/contact.html">Contato</a></li>
        </ul>
    </header>
	<main id="main-area">
        	<h1>Hackintosh (Monterey) com Proxmox</h1>
        	<h2>Introdu√ß√£o</h2>
            <p>Quando se fala em tecnologia Apple, especialmente no territ√≥rio nacional, soa como algo m√°gico: Algo que vai al√©m de um computador pois a maioria das pessoas que tiveram contato com computadores nunca sequer tocaram um hardware da Apple na vida e, grande parte das que tiveram um desses tratam como uma esp√©cie de express√£o da condi√ß√£o social. Como voc√™ que acompanha as minhas documenta√ß√µes bem sabe, aqui temos interesse em acesso a tecnologia sem distin√ß√£o social (a menos que voc√™ tenha um Amiga500 com Vampire ou um Galaxy Book Go rodando Gentoo, nesse caso a√≠ √© full master race mesmo) e testar o MacOS num computador n√£o Apple n√£o √© nenhuma vaca sagrada por aqui. Essa documenta√ß√£o ser√° uma documenta√ß√£o de exemplo de como fazer um <em>Hackintosh</em> utilizando o Proxmox e virtualiza√ß√£o, embora no tutorial do Hackintosh Old Way eu parafraseei o grande Isaque de Hermanoteu na Terra de Godah com o "Cuidado rapaz, a barra aqui √© pesadaa!" o caso pra um Hackintosh com virtualiza√ß√£o √© bem de boa e com um conhecimento b√°sico de Linux e gerenciamento vm's voc√™ vai dar conta (embora possa ser at√© mais demorado).</p>
            <p>Se leitura de documenta√ß√£o em ingl√™s, diagn√≥stico de hardware e gerenciamento de arquivos de configura√ß√£o √© algo complicado pra voc√™... Pode continuar tranquilo pois voc√™ quase n√£o vai precisar mesmo üòÇ essa maneira √© muito tranquila de ser instalada.</p>
            <p>Embora essa instala√ß√£o seja bem mais tranquila ela tamb√©m performa menos, mas se voc√™ s√≥ quer utilizar MacOS sem muita dor de cabe√ßa isso vai te servir.</p>
            <p><strong>Essa documenta√ß√£o foi feita presumindo que voc√™ j√° leu a documenta√ß√£o da instala√ß√£o do Proxmox, j√° o instalou na m√°quina servidor e que j√° saiba um m√≠nimo do gerenciamento de vm's.</strong> Caso n√£o tenha lido acesse esse link <a class="link" href="proxmox_install.html">aqui</a> para ler.</p>
            <h2>Requisitos Recomendados</h2>
            <ul>
                <li>2 computadores, sendo um servidor (que vai rodar a virtualiza√ß√£o) e o guest (para configura√ß√£o via rede), ambos obviamente rodando na mesma rede</li>
                <li>Uma m√°quina com pelo menos 8GB de RAM</li>
                <li>Uma placa de v√≠deo compat√≠vel com o MacOS (para sa√≠da de v√≠deo local)</li>
                <li>Preparar um disco completo para a instala√ß√£o do Proxmox (parti√ß√£o n√£o serve)</li>
                <li>Uma placa de v√≠deo dedicada compat√≠vel com o MacOS (caso queira rodar o sistema na mesma m√°quina em que virtualiza√ß√£o ser√° instalada)</li>
            </ul>
            <h2>Preparando a instala√ß√£o do Proxmox</h2>
            <p><em>√â importante dizer que esse conte√∫do foi feito usando de refer√™ncia o canal Dicas do Mateus e o The Ultimate Beginner's Guide to GPU Passthrough</strong>.</em></p>
            <p>Primeiramente baixe o Proxmox nesse link <a class="link" href="https://www.proxmox.com/en/downloads">aqui</a>, recomendo a vers√£o mais recente do <em>Proxmox VE ISO Installer (BitTorrent)</em>, que no meu caso √© a 7.2 e fa√ßa a instala√ß√£o do Proxmox <em>na m√°quina que virtualizar√° o Mac</em>.</p>
            <img class="responsiva" src="../assets/images/install/macos_new/hackprox0.jpg" alt="">
            <p>Baixe a √∫ltima vers√£o do KVM-Opencore <em>.ISO</em> <a class="link" href="https://github.com/thenickdude/KVM-Opencore/releases">aqui</a>.</p>
            <img class="responsiva" src="../assets/images/install/macos_new/hackprox1.jpg" alt="">
            <p>Baixe a <em>.ISO</em> do MacOS Monterey <a class="link" href="https://1drv.ms/u/s!At8dTzDKak5_gswtd9SSU-6ows-wQA">aqui</a> (upload pelo canal Dicas do Mateus).</p>
            <img class="responsiva" src="../assets/images/install/macos_new/hackprox2.jpg" alt="">
            <p>Acesse a interface do servidor atrav√©s de um navegador e fa√ßa o upload de ambos arquivos de <em>.ISO</em> para a parti√ß√£o <em>Datacenter > PVE > Local</em> no Proxmox.</p>
            <img class="responsiva" src="../assets/images/install/proxmox/proxmox14.jpg" alt="">
            <h2>Criando a VM</h2>
            <p>Assim que terminar o upload de ambos os arquivos v√° em <em>Server View</em> no lado esquerdo da tela selecione em <em>Datacenter > PVE</em> e no canto superior direito selecione a op√ß√£o <em>Create VM</em>.</p>
            <img class="responsiva" src="../assets/images/install/proxmox/proxmox16.jpg" alt="">
            <br>
            <img class="responsiva" src="../assets/images/install/proxmox/proxmox17.jpg" alt="">
            <p>Essa m√°quina virtual deve seguir as configura√ß√µes abaixo.</p>
            <p>Na guia <em>General</em> marque a op√ß√£o <em>Advanced</em> e configure:</p>
            <ul>
                <li>Name: <em>macOS Monterey</em> </li>
            </ul>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac01.jpg" alt="">
            <p>Na guia <em>OS</em>:</p>
            <ul>
                <li>Use CD/DVD disc image file (iso):</li>
                <li>Storage: <em>local</em></li>
                <li>ISO Image: <em>OpenCore-v-XX.iso</em> </li>
                <li>Guest OS:</li>
                <li>Type: <em>Other</em></li>
            </ul>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac02.jpg" alt="">
            <p>Na guia <em>System</em>:</p>
            <ul>
                <li>Graphic Card: <em>VMware Compatible</em></li>
                <li>SCSI Controller: <em>VirtIO SCSI</em></li>
                <li>BIOS: <em>OVMF (UEFI)</em></li>
                <li>Machine: <em>q35</em></li>
                <li>Storage: <em>local-lvm</em></li>
            </ul>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac03.jpg" alt="">
            <p>Na guia <em>Hard Disk</em>:</p>
            <ul>
                <li>Bus/Device: <em>VirtIO Block</em></li>
                <li>Storage: <em>local-lvm</em></li>
                <li>Disk Size (GiB): <em>64</em> (pelo menos)</li>
                <li>Cache: <em>Write back (unsafe)</em></li>
            </ul>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac04.jpg" alt="">
            <p>Na guia <em>CPU</em>:</p>
            <ul>
                <li>Cores: <em>4</em></li>
                <li>Type: <em>Penryn</em> </li>
            </ul>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac05.jpg" alt="">
            <p>Na guia <em>Memory</em>:</p>
            <ul>
                <li>Memory (MiB: <em>4096</em> (pelo menos)</li>
            </ul>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac06.jpg" alt="">
            <p>Na guia <em>Network</em>:</p>
            <ul>
                <li>Model: <em>VMware vmxnet3</em></li>
            </ul>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac07.jpg" alt="">
            <p>E na guia <em>Confirm</em> apenas selecione <em>Finish</em>.</p>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac08.jpg" alt="">
            <h2>Configurando a VM</h2>
            <p>Com a m√°quina virtual criada e com uma m√≠dia de boot selecionada (<em>OpenCore-v-XX.iso</em>), agora devemos adicionar um drive virtual nela contendo a imagem do MacOS. Para isso no <em>Server View</em> a esquerda selecione <em>Datacenter > PVE > macOS Monterey</em>, e nas op√ß√µes da m√°quina virtual selecione <em>Hardware > Add > CD/DVD Drive</em>.</p>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac09.jpg" alt="">
            <p>Agora selecionaremos a iso de instala√ß√£o:</p>
            <p>Marque <em>Use CD/DVD disc image file (.iso)</em> e configure:</p>
            <ul>
                <li>Storage: <em>local</em></li>
                <li>ISO Image: <em>Monterey-full.img</em> </li>
            </ul>
            <p>Depois clique em <em>Create</em></p>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac10.jpg" alt="">
            <br>
            <p>Com a m√°quina virtual criada precisamos agora alterar a ordem de boot, para isso acesse <em>Datacenter > PVE > macOS Monterey</em> na guia de op√ß√µes selecione <em>Options</em> e depois d√™ dois cliques em <em>Boot Order</em>.</p>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac11.jpg" alt="">
            <p>E depois clique e arraste o <em>IDE2</em> para o primeiro item de boot.</p>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac12.jpg" alt="">
            <p>Como na figura abaixo:</p>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac13.jpg" alt="">
            <p>Agora precisamos fazer algumas altera√ß√µes no Shell, para isso selecione <em>Datacenter > PVE > Shell</em></p>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac14.jpg" alt="">
            <p>Primeiramente voc√™ precisa editar o arquivo de configura√ß√£o da vm com o nano (ou o seu editor preferido), para isso utilize o comando:</p>
            <code>nano /etc/pve/qemu-server/100.conf</code>
            <p>ps: Considerando que a sua VM possui a ID <em>100</em>, caso voc√™ tenha alterado o ID da m√°quina virtual, altere o nome do arquivo <em>.conf</em> tamb√©m para:</p>
            <code><em>n√∫mero da id de vm que voc√™ escolheu</em>.conf</code>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac15.jpg" alt="">
            <p>Na linha de configura√ß√£o da <em>.IMG</em> de instala√ß√£o do MacOS (Monterey-full.img) altere de:</p>
            <code>ide0: local:iso/Monterey-full.img,<em>media=cdrom</em>,size=14G</code>
            <p>Para:</p>
            <code>ide0: local:iso/Monterey-full.img,<em>cache=unsafe</em>,size=14G</code>
            <p>E na linha de configura√ß√£o da <em>.ISO</em> do KVM-Opencore (OpenCore-vXX.iso) altere de:</p>
            <code>ide2: local:iso/OpenCore-vXX.iso,<em>media=cdrom</em></code>
            <p>Para:</p>
            <code>ide2: local:iso/OpenCore-vXX.iso,<em>cache=unsafe</em></code>
            <p>Por fim voc√™ precisa adicionar uma √∫ltima linha de argumentos ao final desse arquivo de texto, mas qual linha voc√™ deve utilizar depende de qual √© o processador da m√°quina em que o Proxmox est√° instalado.</p>
            <p>Caso voc√™ tenha uma plataforma <em>Intel</em>:</p>
            <code>args: -device isa-applesmc,osk="ourhardworkbythesewordsguardedpleasedontsteal(c)AppleComputerInc" -smbios type=2 -device usb-kbd,bus=ehci.0,port=2 -global nec-usb-xhci.msi=off -cpu host,kvm=on,vendor=GenuineIntel,+kvm_pv_unhalt,+kvm_pv_eoi,+hypervisor,+invtsc</code>
            <p>Caso voc√™ tenha uma plataforma <em>AMD</em>:</p>
            <code>args: -device isa-applesmc,osk="ourhardworkbythesewordsguardedpleasedontsteal(c)AppleComputerInc" -smbios type=2 -device usb-kbd,bus=ehci.0,port=2 -global nec-usb-xhci.msi=off -cpu Penryn,kvm=on,vendor=GenuineIntel,+kvm_pv_unhalt,+kvm_pv_eoi,+hypervisor,+invtsc,+pcid,+ssse3,+sse4.2,+popcnt,+avx,+avx2,+aes,+fma,+fma4,+bmi1,+bmi2,+xsave,+xsaveopt,check</code>
            <p>E o seu arquivo de configura√ß√£o deve ficar mais ou menos assim:</p>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac16.jpg" alt="">
            <p>Depois que finalizar a edi√ß√£o use o comando <em>Control + x</em> para sair do nano, ele vai perguntar se voc√™ deseja salvar (<i>Save modified buffer?</i>) , digite <em>Y</em> para <i>Yes</i> e depois tecle <em>Enter</em> para confirmar a sobrescri√ß√£o do arquivo, o shell vai retornar ao seu ponto inicial.</p>
            <img class="responsiva" src="../assets/images/install/proxmox/proxmox13.jpg" alt="">
            <p>Com tudo configurado agora basta iniciar a vm clicando em <em>Start</em> e depois <em>Console</em> e voc√™ ter√° acesso ao sistema virtualizado.</p>
            <img class="responsiva" src="../assets/images/install/proxmox/proxmox27.jpg" alt="">
            <p>Selecione ent√£o a op√ß√£o <em>Install macOS Monterey</em> e prossiga com a instala√ß√£o, se voc√™ nunca instalou o macOS antes voc√™ pode seguir como refer√™ncia essa documenta√ß√£o <a class="link" href="hackintosh.html">aqui</a> (siga do <em>Iniciando a Instala√ß√£o</em> at√© o <em>Configura√ß√£o inicial do sistema</em>) </p>
            <p>Mas lembre-se que o dispositivo a ser apagado para instala√ß√£o do sistema dentro da vm vai ser o disco <em>Apple Inc. VirtIO Block Media</em>, <strong>como na segunda imagem abaixo</strong></p>
            <p>ps: Sim, o come√ßo da instala√ß√£o demora bastante na vm...</p>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac17.jpg" alt="">
            <br>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac18.jpg" alt="">
            <p>Lembre se que toda vez que o sistema reiniciar e voltar nessa tela, voc√™ deve selecionar a op√ß√£o <em>macOS Installer</em> (como na imagem abaixo)</p>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac19.jpg" alt="">
            <p>Assim que o sistema finalizar a instala√ß√£o e reiniciar, quando voltar para a tela inicial a op√ß√£o <em>macOS Installer</em> vai mudar para <em>macOS</em>, selecione essa op√ß√£o para continuar a instala√ß√£o assim como na imagem abaixo:</p>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac20.jpg" alt="">
            <p>Configure o sistema normalmente, se voc√™ nunca configurou o macOS antes voc√™ pode seguir como refer√™ncia essa documenta√ß√£o <a class="link" href="hackintosh.html">aqui</a> (siga do <em>Configura√ß√£o inicial do sistema</em> at√© a <em>identifica√ß√£o do esquema de teclado</em>)</p>
            <img class="responsiva" src="../assets/images/install/macos_old/macos29.jpg" alt="">
            <p>Pronto! Com o sistema funcionando siga com a identifica√ß√£o do esquema de teclado.</p>
            <h2>P√≥s-instala√ß√£o para o Proxmox</h2>
            <p>O MacOS est√° instalado na m√°quina virtual mas ainda n√£o possui bootloader, ou seja, ainda n√£o existe maneira de fazer com que o sistema inicialize o macOS sozinho ( <strong>portanto n√£o deslique ou reinicie a m√°quina virtual para n√£o ter dor de cabe√ßa desnecess√°ria</strong>). O processo aqui √© id√™ntico ao descrito no tutorial do Hackintosh (Old Way) mas utiliza outros arquivos para o boot, ent√£o vamos resolver isso...</p>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac21.jpg" alt="">
            <p>Primeiramente acesse esse link <a class="link" href="https://github.com/thenickdude/KVM-Opencore/releases">aqui</a>, baixe o <em>OpenCoreEFIFolder-vXX.zip</em> (como na imagem acima), extraia e copie a pasta <em>EFI</em> do arquivo rec√©m extra√≠do para a √°rea de trabalho</p>
            <img class="responsiva" src="../assets/images/install/macos_old/macpost1.jpg" alt="">
            <p>Para acessar a parti√ß√£o EFI do computador utilizaremos o script <em>MountEFI</em>. Para isso acesse <a class="link" href="https://github.com/corpnewt/MountEFI">esse link</a> e clique em <em>Mount EFI Automator Quick Action.zip</em>.</p>
            <img class="responsiva" src="../assets/images/install/macos_old/macpost2.jpg" alt="">
            <p>Depois clique em <em>Download</em></p>
            <img class="responsiva" src="../assets/images/install/macos_old/macpost3.jpg" alt="">
            <p>Conceda acesso de downloads para o Github.</p>
            <img class="responsiva" src="../assets/images/install/macos_old/macpost4.jpg" alt="">
            <p>Assim que o download finalizar clique na pasta de Downloads e abra o Mount EFI.</p>
            <img class="responsiva" src="../assets/images/install/macos_old/macpost5.jpg" alt="">
            <p>O sistema vai perguntar se voc√™ deseja instalar o script, selecione <em>Instalar</em>.</p>
            <img class="responsiva" src="../assets/images/install/macos_old/macpost6.jpg" alt="">
            <p>O Mac provavelmente vai mostrar uma janela com os scripts instalados, voc√™ pode simplesmente fechar essa janela.</p>
            <img class="responsiva" src="../assets/images/install/macos_old/macpost7.jpg" alt="">
            <p>Depois na barra de tarefas selecione o <em>Finder</em> no canto superior esquerdo da tela, e depois em <em>Prefer√™ncias</em>.</p>
            <img class="responsiva" src="../assets/images/install/macos_old/macpost8.jpg" alt="">
            <p>Marque a op√ß√£o <em>Discos r√≠gidos</em> e ent√£o o √≠cone do HD vai aparecer na √°rea de trabalho.</p>
            <img class="responsiva" src="../assets/images/install/macos_old/macpost9.jpg" alt="">
            <p>Clique com o bot√£o direito no √≠cone do HD e selecione a op√ß√£o <em>Mount EFI</em>, insira a senha para garantir a permiss√£o.</p></p>
            <img class="responsiva" src="../assets/images/install/macos_old/macpost10.jpg" alt="">
            <p>Arraste a pasta <em>EFI</em> que voc√™ extraiu do arquivo <em>OpenCoreEFIFolder-vXX.zip</em> para a raiz da parti√ß√£o EFI do HD. Ap√≥s isso, desligue a m√°quina virtual (atrav√©s das op√ß√µes do sistema operacional mesmo).</p>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac22.jpg" alt="">
            <p>Assim que a m√°quina virtual desligar, v√° em <em>Datacenter > PVE > MacOS</em> e na op√ß√£o <em>Hardware</em> selecione o <em>CD/DVD Drive</em> correspondente ao <em>Monterey-full.img</em> e na guia superior selerione <em>Remove</em> para remover a imagem de instala√ß√£o j√° que n√£o precisamos mais dela</p>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac23.jpg" alt="">
            <p>Agora selecione o <em>Hard Disk</em> correspondente ao <em>OpenCore-vXX.iso</em> e na guia superior selerione <em>Detach</em> para remover a imagem de inicializa√ß√£o j√° que n√£o precisamos mais dela</p>
            <img class="responsiva" src="../assets/images/install/proxmox/proxmox27.jpg" alt="">
            <p>Agora d√™ <em>Start</em> e <em>Console</em> e verifique se o sistema vai iniciar corretamente</p>
            <h2>GPU Passthrough</h2>
            <p>Ent√£o voc√™ quer acessar o MacOS na mesma m√°quina em que instalou o servidor Proxmox? Se voc√™ tem uma placa de v√≠deo compat√≠vel com o MacOS √© bem tranquilo de fazer.</p>
            <h3>Prepara√ß√£o da BIOS</h3>
            <p>A primeira coisa que voc√™ precisa fazer para habilitar o passthrough √© configurar a bios corretamente, aqui vai uma lista simples do que voc√™ deve habilitar e desabilitar:</p>
            <p><em>Habilite</em></p>
            <ul>
                <li>IOMMU</li>
                <li>AMD-Vi / Intel VT-d</li>
                <li>multi-monitor / multi-display</li>
            </ul>
            <p><em>Desabilite</em></p>
            <ul>
                <li>CSM</li>
            </ul>
            <h3>Configura√ß√£o do Proxmox</h3>
            <p>A primeira coisa que precisamos fazer para o nosso passthrough √© configurar o grub, para isso edite o arquivo <em>/etc/default/grub</em>, e na linha:</p>
            <code>GRUB_CMDLINE_LINUX_DEFAULT="quiet"</code>
            <p>Agora devemos adicionar um comando para habilitar o iommu, por√©m varia conforme o seu processador, se o seu processador √© AMD edite para que fique assim:</p>
            <code>GRUB_CMDLINE_LINUX_DEFAULT="quiet amd_iommu=on"</code>
            <p>Se o seu processador √© Intel, edite para que fique assim:</p>
            <code>GRUB_CMDLINE_LINUX_DEFAULT="quiet intel_iommu=on"</code>
            <p>Salve o documento, e para atualizar o grub utilize o comando:</p>
            <code>update-grub</code>
            <p>Agora precisamos acrescentar alguns m√≥dulos ao Proxmox, para isso acesse <em>/etc/modules</em> e adicione as linhas:</p>
            <code>
                vfio<br>
                vfio_iommu_type1<br>
                vfio_pci<br>
                vfio_virqfd
            </code>
            <p>Salve o arquivo</p>
            <p>Precisamos agora alterar o Remapeamento de interrup√ß√£o IOMMU, para isso basta utilizar os comandos abaixo:</p>
            <code>echo "options vfio_iommu_type1 allow_unsafe_interrupts=1" > /etc/modprobe.d/iommu_unsafe_interrupts.conf</code>
            <code>echo "options kvm ignore_msrs=1" > /etc/modprobe.d/kvm.conf</code>
            <p>Agora precisamos colocar os drivers de gpu na blacklist para que o Proxmox n√£o utilize nossa gpu, para isso basta utilizar os comandos abaixo:</p>
            <code>echo "blacklist radeon" >> /etc/modprobe.d/blacklist.conf</code>
            <code>echo "blacklist nouveau" >> /etc/modprobe.d/blacklist.conf</code>
            <code>echo "blacklist nvidia" >> /etc/modprobe.d/blacklist.conf</code>
            <p>Agora precisamos passar a nossa gpu para passthrough, para isso liste as interfaces pci com o comando:</p>
            <code>lspci -v</code>
            <p>Vai retornar diversas linhas, mas basta procurar a linha da sua placa de v√≠deo que est√° mais ou menos assim (considerando <strong>por exemplo</strong> que voc√™ tenha uma <em>GTX 1070</em>):</p>
            <code><em>01:00</em>.0 VGA compatible controller: NVIDIA Corporation GP104 [GeForce GTX 1070] (rev a1) (prog-if 00 [VGA controller])</code>
            <p>Se atente para o n√∫mero do come√ßo da linha, utilize o comando abaixo com esse mesmo identificador (<strong>claro, substituindo o identificador da linha para o da sua placa de v√≠deo</strong>)</p>
            <code>lspci -n -s <em>01:00</em></code>
            <p>E ir√° retornar o <i>Vendor ID</i> da sua gpu, mais ou menos assim:</p>
            <code>01:00.0 0000: <em>10de:1b81</em> (rev a1)<br>01:00.1 0000: <em>10de:10f0</em> (rev a1)</code>
            <p>O interessante para n√≥s aqui s√£o esses c√≥digos de identifica√ß√£o de fornecedor: <em>10de:1b81</em> e <em>10de:10f0</em>. Vamos adicionar esses IDs do fornecedor da GPU ao VFIO (<strong>lembre-se de substituir os ids pelos ids da sua gpu!</strong>):</p>
            <code>echo "options vfio-pci ids=<em>10de:1b81</em>,<em>10de:10f0</em> disable_vga=1"> /etc/modprobe.d/vfio.conf</code>
            <p>Agora basta atualizar o <em>initramfs</em> com o comando:</p>
            <code>update-initramfs -u</code>
            <p>E resetar o sistema:</p>
            <code>reset</code>
            <h3>Adicionar a GPU para a M√°quina Virtual</h3>
            <p>Uma vez que o Proxmox j√° foi configurado para o passthrough falta apenas atrelar a GPU a m√°quina virtual do MacOS, para isso selecione <em>Datacenter > PVE > MacOS</em> e na guia <em>Hardware</em> selecione <em>Add > PCI Device</em>. </p>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac24.jpg" alt="">
            <p>No menu de <em>Add: PCI Device</em>, clique na guia de sele√ß√£o em frente a <em>Device:</em> e selecione a sua GPU entre os itens dessa lista.</p>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac25.jpg" alt="">
            <p>Depois de ter selecionado a sua GPU marque as op√ß√µes <em>Primary GPU</em> e <em>PCI-Express</em>, e por √∫ltimo clique no bot√£o <em>Add</em> para confirmar a adi√ß√£o de dispositivo.</p>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac26.jpg" alt="">
            <p>Lembre-se de confirmar que a op√ß√£o de <em>Display</em> est√° como <em>none (none)</em>.</p>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac27.jpg" alt="">
            <p>Se voc√™ quiser que o sistema inicie automaticamente na m√°quina do Proxmox basta ir na guia <em>Options</em> e deixar a op√ß√£o <em>Start at boot</em> como <em>yes</em>.</p>
            <img class="responsiva" src="../assets/images/install/macos_new/proxmoxmac28.jpg" alt="">
            <h3>Acessando a VM pelo pr√≥prio Proxmox</h3>
            <p>Embora eu n√£o recomendo (a menos que seja para testes muito espec√≠ficos), voc√™ pode simplesmente subir uma interface gr√°fica na m√°quina do Proxmox e um navegador e acessar as VM's assim como se tivesse fazendo de uma outra m√°quina em rede. Considerando que o sistema j√° est√° devidamente atualizado, instalaremos um <em>Ambiente Gr√°fico</em>, um <em>Navegador</em> e um <em>Gerenciador de Display</em>.</p>
            <p>Nesse caso eu escolhi o <em>LxQT</em> para interface, o <em>Firefox</em> como navegador e o <em>LightDM</em> como gerenciador de display, fique a vontade para substituir o LightDM para Mate ou Firefox para Chromium <strong>MAS</strong> essa √© a minha recomenda√ß√£o.</p>
            <p><strong>Lembrando:</strong> Essa parte foi feita considerando que voc√™ vai acessar diretamente as VM's pela m√°quina do Proxmox.</p>
            <code>apt install lxqt firefox lightdm</code>
            <p>Crie um novo usu√°rio padr√£o com o comando:</p>
            <code>adduser <em>seunomedeusu√°rio</em></code>
            <p>Agora vamos ativar o servi√ßo do LightDM para iniciar na inicializa√ß√£o com o comando:</p>
            <code>systemctl start lightdm</code>
            <p>Reinicie o sistema com:</p>
            <code>reboot</code>
            <p>Assim que o sistema reiniciar voc√™ ver√° o <em>LightDM</em>, use o seu usu√°rio padr√£o para logar, abra o navegador e acesse a interface web do Promxox pelo endere√ßo <em>127.0.0.1:8006</em> no navegador.</p>
        </main>
        <footer id="main-footer">
            <p>Est√° p√°gina ainda est√° em constru√ß√£o üöß</p>
            <a class="footerlink" href="#main-header">‚Üë Retornar ao topo ‚Üë</a>
        </footer>
</body>
</html>
